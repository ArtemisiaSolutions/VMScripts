#!/bin/sh
ALLARGS="yes"

if [ -z "$1" ] ; then
    ALLARGS="no"
fi

if [ -z "$2" ] ; then
    ALLARGS="no"
fi

if [ -z "$3" ] ; then
    ALLARGS="no"
fi

if [ "$ALLARGS" = "no" ]; then
  echo "ERROR: Parameter missing. Did you forget the username?"
  echo "-------------------------------------------------------------"
  echo "USAGE:"
  echo "Compress node tar ball"
  echo "-> $0 username owner project"
  echo
  exit
fi

CHROOT_USERNAME=$1
OWNER=$2
PROJECT=$3
JAILROOT="/jail"

if [ -d "/media/internalStorage" ]; then
    JAILROOT="/media/internalStorage"
fi

JAILPATH="$JAILROOT/$CHROOT_USERNAME"
HOMEDIR="$JAILPATH/home/$CHROOT_USERNAME"
NODE_MODULES_FOLDER="$HOMEDIR/$OWNER/$PROJECT/node_modules"

TARBALL_DIR="/node_tarball" 

#Compressing node modules folder
if [ -d $TARBALL_DIR ]; then
    if [ -f "$TARBALL_DIR/$OWNER-$PROJECT.tar.gz" ]; then
         cd "$HOMEDIR/$OWNER/$PROJECT"; tar -xzf "$TARBALL_DIR/$OWNER-$PROJECT.tar.gz"; chown -R $CHROOT_USERNAME:$CHROOT_USERNAME $NODE_MODULES_FOLDER
    fi;
fi
