#!/bin/sh
ALLARGS="yes"

if [ -z "$1" ] ; then
    ALLARGS="no"
fi

if [ -z "$2" ] ; then
    ALLARGS="no"
fi

if [ -z "$3" ] ; then
    ALLARGS="no"
fi

if [ "$ALLARGS" = "no" ]; then
  echo "ERROR: Parameter missing. Did you forget the username?"
  echo "-------------------------------------------------------------"
  echo "USAGE:"
  echo "Compress node tar ball"
  echo "-> $0 username owner project"
  echo
  exit
fi

CHROOT_USERNAME=$1
OWNER=$2
PROJECT=$3
JAILROOT="/jail"

if [ -d "/media/ephemeral0" ]; then
    JAILROOT="/media/ephemeral0"
fi

JAILPATH="$JAILROOT/$CHROOT_USERNAME"
HOMEDIR="$JAILPATH/home/$CHROOT_USERNAME"
NODE_MODULES_FOLDER="$HOMEDIR/$OWNER/$PROJECT/node_modules"

TARBALL_DIR="/node_tarball" 

echo $NODE_MODULES_FOLDER

if [ ! -d "$TARBALL_DIR" ]; then
    mkdir $TARBALL_DIR
fi

#Compressing node modules folder
if [ -d $NODE_MODULES_FOLDER ]; then
    cd $TARBALL_DIR; rm "$OWNER-$PROJECT.tar.gz"; tar -czf "$OWNER-$PROJECT.tar.gz" -C "$HOMEDIR/$OWNER/$PROJECT" node_modules;
fi
